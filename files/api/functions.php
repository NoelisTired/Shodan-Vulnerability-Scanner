<?php
session_start();
error_reporting(0);
ini_set('display_errors', 0);
function getVulnerabilities(){
    $context = stream_context_create(['http' => ['ignore_errors' => true]]);
    $result = file_get_contents("https://api.shodan.io/shodan/host/".apache_request_headers()["X-Forwarded-For"]."?key= INPUT API KEY HERE", false, $context);
    foreach( $http_response_header as $key => $value){
        if($value == "HTTP/1.1 404 Not Found"){
            die("We were not able to check your IP for vulnerabilities!");
        }
    }
    $count = 0;
    $arr = json_decode($result, true);
        foreach ($arr as $key => $value) {
            if ($key == "error") {
                die("We were not able to check your IP for vulnerabilities!");
            }
            elseif ($key == 'vulns') {
                foreach ($value as $v) {
                    $count++;
            }
        }
    }

    if ($count == 0) {
        $response = "We were unable to find any vulnerabilities!";
    }
    elseif ($count == 1) {
        $response = "Beware, we've found " . $count . " vulnerability!";
    }
    elseif ($count >= 2) {
        $response = "Beware, we've found " . $count . " vulnerabilities!";
    }
    else {
    }
    die($response);

}
?>
